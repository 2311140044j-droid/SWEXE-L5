<h1>つぶやき一覧</h1>

<% if logged_in? %>
  <%= form_with(model: @tweet, url: tweets_path, local: true) do |f| %>
    <p><%= f.text_area :content, rows: 3, placeholder: 'いまどうしてる？' %></p>
    <%= f.submit 'つぶやく' %>
  <% end %>
<% else %>
  <p>ログインするとつぶやきやいいねができます。</p>
<% end %>

<hr>

<% @tweets.each do |tweet| %>
  <div style="border:1px solid #ccc; padding:8px; margin-bottom:8px;">
    <strong><%= tweet.user.name || tweet.user.username %></strong>
    <small><%= tweet.created_at.strftime('%Y-%m-%d %H:%M') %></small>
    <p><%= h(tweet.content) %></p>
    <p>❤️ <%= tweet.likes.count %></p>

    <% if logged_in? %>
      <% if current_user.liked?(tweet) %>
        <%= button_to 'いいねを外す', tweet_like_path(tweet), method: :delete %>
      <% else %>
        <%= button_to 'いいね', tweet_like_path(tweet), method: :post %>
      <% end %>

      <% if tweet.user == current_user %>
        <%= button_to '削除', tweet_path(tweet), method: :delete, data: { confirm: '本当に削除しますか？' } %>
      <% end %>
    <% end %>
  </div>
<% end %>